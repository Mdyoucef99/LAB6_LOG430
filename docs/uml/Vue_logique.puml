@startuml
title Diagramme Machine d'État

[*] --> INITIÉE : Demande de Commande Reçue

INITIÉE --> PANIER_VALIDÉ : Panier Valide
INITIÉE --> ÉCHOUÉE : Panier Invalide/Vide

PANIER_VALIDÉ --> STOCK_RÉSERVÉ : Stock Disponible
PANIER_VALIDÉ --> ÉCHOUÉE : Stock Insuffisant/Erreur

STOCK_RÉSERVÉ --> COMMANDE_CRÉÉE : Commande Créée avec Succès
STOCK_RÉSERVÉ --> COMPENSATION_EN_COURS : Échec Création Commande

COMMANDE_CRÉÉE --> PANIER_VIDÉ : Panier Vidé avec Succès
COMMANDE_CRÉÉE --> COMPENSATION_EN_COURS : Échec Vidage Panier

PANIER_VIDÉ --> TERMINÉE : Saga Terminée avec Succès

COMPENSATION_EN_COURS --> STOCK_LIBÉRÉ : Stock Libéré avec Succès
COMPENSATION_EN_COURS --> COMPENSATION_ÉCHOUÉE : Échec Libération Stock

STOCK_LIBÉRÉ --> ÉCHOUÉE : Compensation Terminée
COMPENSATION_ÉCHOUÉE --> ÉCHOUÉE : Intervention Manuelle Requise

TERMINÉE --> [*] : État Final de Succès
ÉCHOUÉE --> [*] : État Final d'Échec


note right of TERMINÉE
  Commande confirmée
end note

note right of ÉCHOUÉE
  Processus arrêté
end note

@enduml 